;!function(require, directRequire){;"use strict";const tslib_1=require("tslib"),React=require("react"),{connect}=require("react-redux"),path=require("path"),classNames=require("classnames"),windowActions=require('./a8c87029da0fa06e986298d447ab0fe2.js'),projectActions=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),simulatorActions=require('./ba23d8b47b1f4ea08b9fd49939b9443f.js'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),compileTypeConfig=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),DropDown=require('./3c55dff3626a3ee184d599f076158345.js'),cssConfig=require('./3b5f8e2469c474c8d433c1c6926d8999.js'),weappConfig=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),Animation=require('./875171e7b864aa58d026d4fa0999fbd1.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js'),locales=require('./common/locales/index.js'),topTools=require('./84b183688a46c9e2626d3e6f83365e13.js'),mapStateToProps=(a)=>{const b=a.project.current;let c=b.compileType;c===compileTypeConfig.plugin&&(c=compileTypeConfig.weapp);const d=b.condiction&&b.condiction[c]||{},e=a.window.customCompile,f=e.id,g=d.list&&d.list[f]||{},h=a.simulator.appConfig&&a.simulator.appConfig||{},i=[...(h.pages||[])];if(h.subPackages)for(const a of h.subPackages)for(const b of a.pages)i.push(topTools.normalizePath(path.posix.join(a.root,b)));const j=b.runtimeAttr&&b.runtimeAttr.share_info||[],k=a.simulator,l=a.simulator.webviewInfos[a.simulator.currentWebviewID]||{},m=l.pathName;return{show:e&&(e.show===compileTypeConfig.weapp||e.show===compileTypeConfig.plugin),project:a.project.current,appConfig:a.simulator.appConfig||{},sceneMap:a.config.sceneMap||{},sceneList:a.config.sceneList||[],pathName:m,groupList:j,pages:i,id:f,data:g,simulateUpdate:k.simulateUpdate}},mapDispatchToProps=(a)=>({setCustomCompile:tools.bindActionCreators(windowActions.setCustomCompile,a),projectActions:tools.bindActionCreators(projectActions,a),simulatorActions:tools.bindActionCreators(simulatorActions,a)});let CustomCompile=class extends React.Component{constructor(a){super(a),this.onInputChange=(a)=>{const b=a.currentTarget,c=b.dataset,d=c.type;this.setState({[d]:b.value})},this.onSimulateUpdateChange=()=>{this.setState({simulateUpdate:!this.state.simulateUpdate})},this.onClose=()=>{this.setState({show:!1})},this.onConfirm=()=>{if(!this.state.name)return void this.nameInput.focus();const a=this.state.pathName||this.props.pages[0],b=this.state.scene,c={id:this.props.id,name:this.state.name,pathName:a,query:this.state.query,scene:b};if(b===weappConfig.SCENE_SHARE_TICKET&&(c.shareInfo=this.state.shareInfo),(this.couldInputExtralData(b)||this.couldInputAppId(b))&&(c.referrerInfo={},this.couldInputAppId(b)&&(c.referrerInfo.appId=this.state.appId),this.couldInputExtralData(b))){try{this.checkValidExtraData(this.state.extraData)}catch(a){return this.setState({extraDataErr:locales.config.PARSE_ERROR+"\uFF0C"+a}),void this.extraInput.focus()}c.referrerInfo.extraData=this.state.extraData}this.props.projectActions.setCompileCondiction(c),this.props.simulatorActions.setSimulateUpdate(this.state.simulateUpdate),this.onClose(),report("weapp_add_debugproto",this.props.project.appid)},this.onDelete=()=>{this.props.projectActions.removeCompileCondiction({id:this.props.id}),this.onClose(),report("weapp_del_debugproto",this.props.project.appid)},this.onPageDropDownClick=(a)=>{a.stopPropagation();const b=a.currentTarget.getBoundingClientRect(),c=this.pageInput.value,d=this.props.pages.filter((a)=>0<=a.indexOf(c));this.setState({dropDownHeight:300,dropDownLeft:b.left,dropDownTop:b.top+b.height,dropDownShow:!0,dropDownType:"page",dropDownList:d})},this.onAllPageDropDownClick=(a)=>{a.stopPropagation();const b=a.currentTarget.getBoundingClientRect();this.setState({dropDownHeight:300,dropDownLeft:b.left-437,dropDownTop:b.top+b.height,dropDownShow:!0,dropDownType:"page",dropDownList:this.props.pages})},this.onSceneDropDownClick=(a)=>{a.stopPropagation();const b=a.currentTarget.getBoundingClientRect(),c=this.sceneInput.value,d=this.props.sceneList.map((a)=>`${a.value}: ${a.name}`),e=d.filter((a)=>0<=a.indexOf(c));this.setState({dropDownHeight:300,dropDownLeft:b.left,dropDownTop:b.top+b.height,dropDownShow:!0,dropDownType:"scene",dropDownList:e})},this.onAllSceneDropDownClick=(a)=>{a.stopPropagation();const b=a.currentTarget.getBoundingClientRect(),c=this.props.sceneList.map((a)=>`${a.value}: ${a.name}`);this.setState({dropDownHeight:300,dropDownLeft:b.left-437,dropDownTop:b.top+b.height,dropDownShow:!0,dropDownType:"scene",dropDownList:c})},this.onGroupDropDownClick=(a)=>{a.stopPropagation();const b=a.currentTarget.getBoundingClientRect(),c=this.props.groupList.map((a)=>`${a.room_topic}`);this.setState({dropDownHeight:"auto",dropDownLeft:b.left,dropDownTop:b.top,dropDownShow:!0,dropDownType:"group",dropDownList:c})},this.onDropDownSelect=(a)=>{const b=this.state.dropDownType;"group"===b?this.onGroupSelect(a):"scene"===b?this.onSceneSelect(a):"page"===b&&this.onPageSelect(a)},this.changeExtraData=(a)=>{const b=a.target.value;let c="";try{this.checkValidExtraData(b)}catch(a){c=locales.config.PARSE_ERROR+"\uFF0C"+a}this.setState({extraData:b,extraDataErr:c})},this.onContainerClick=(a)=>{a.stopPropagation(),this.setState({dropDownShow:!1})},this.onPagePathChange=(a)=>{const b=a.currentTarget.value,c=this.props.pages.filter((a)=>0<=a.indexOf(b));this.setState({pathName:b,dropDownList:c})},this.onSceneChange=(a)=>{const b=a.currentTarget.value,c=this.props.sceneList.map((a)=>`${a.value}: ${a.name}`),d=c.filter((a)=>0<=a.indexOf(b));this.setState({sceneWording:b,dropDownList:d})},this.onAnimationOut=()=>{this.props.setCustomCompile({show:!1})},this.state=this.resetState(a)}componentWillReceiveProps(a){let b={};if(a.show&&(b.lazyLoaded=!0),a.sceneMap!==this.props.sceneMap){const c=this.state.scene;b.sceneWording=`${c}: ${a.sceneMap[c]}`,b.groupFormShow=c===weappConfig.SCENE_SHARE_TICKET}a.pathName!==this.props.pathName&&(b.pathName=a.data.pathName||a.pathName),a.simulateUpdate!==this.props.simulateUpdate&&(b.simulateUpdate=a.simulateUpdate),a.id!==this.props.id&&(b=Object.assign({},b,this.resetState(a))),a.show!==this.props.show&&(b.show=a.show,b=Object.assign({},b,this.resetState(a))),this.setState(b)}resetState(a){const b=parseInt(a.data.scene,10),c=a.data.shareInfo,d=a.data.referrerInfo,e=a.sceneMap[b],f=b===weappConfig.SCENE_SHARE_TICKET;return Object.assign({simulateUpdate:a.simulateUpdate,lazyLoaded:a.show,pathName:a.pathName,sceneWording:e&&`${b}: ${e}`,groupWording:c&&c.groupName||"",groupFormShow:f},d,a.data,{scene:b})}onPageSelect(a){this.setState({pathName:this.state.dropDownList[a],dropDownShow:!1})}onSceneSelect(a){const b=this.state.dropDownList[a],c=parseInt(b.split(": ")[0],10),d=c===weappConfig.SCENE_SHARE_TICKET;this.setState({scene:c,sceneWording:b,dropDownShow:!1,groupFormShow:d})}couldInputAppId(a){return a===weappConfig.SCENE_MINI_PROGRAM||a===weappConfig.SCENE_MINI_PROGRAM_BACK||a===weappConfig.SCENE_PROFILE||a===weappConfig.SCENE_CUSTOM_MENU||a===weappConfig.SCENE_APP_SHARE_MESSAGE||a===weappConfig.SCENE_TEMPLETE_MESSAGE}couldInputExtralData(a){return a===weappConfig.SCENE_MINI_PROGRAM||a===weappConfig.SCENE_MINI_PROGRAM_BACK}onGroupSelect(a){const b=this.props.groupList[a],c=b.room_topic;this.setState({shareInfo:{groupName:c,shareName:b.share_name,shareKey:b.share_key},groupWording:c,dropDownShow:!1})}checkValidExtraData(a){const b=JSON.parse(a);if("[object Object]"!==Object.prototype.toString.call(b))throw new Error(locales.config.MUST_BE_OBJECT)}shouldComponentUpdate(a){return a.show!==this.props.show||this.props.show}render(){if(!this.state.lazyLoaded)return null;const a=this.props,b={display:-1===a.id?"none":""};return React.createElement("div",{onClick:this.onContainerClick,style:{display:this.props.show?"":"none",height:"100%",width:"100%",position:"absolute",zIndex:1e3}},React.createElement(DropDown,{width:455,left:this.state.dropDownLeft,top:this.state.dropDownTop,show:this.state.dropDownShow,list:this.state.dropDownList,height:this.state.dropDownHeight,onSelectClick:this.onDropDownSelect,allowKeyboardControl:!0}),React.createElement(Animation,{show:this.state.show,inClassName:"ui-animate-pull-down ui-dialog",outClassName:"ui-animate-pull-up ui-dialog",onAnimationOut:this.onAnimationOut,style:{width:600,marginLeft:-300}},React.createElement("div",{className:"ui-dialog-hd"},React.createElement("h3",{className:"ui-dialog-title"},locales.config.CUSTOM_COMPILATION_CONDITION)),React.createElement("div",{className:"ui-dialog-bd"},React.createElement("div",{className:"ui-form"},React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label"},locales.config.MODE_NAME),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text","data-type":"name",ref:(a)=>{this.nameInput=a},value:this.state.name,onChange:this.onInputChange,className:"ui-input"})))),React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label"},locales.config.STARTUP_PAGE),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-selector ui-selector-default",onClick:this.onPageDropDownClick},React.createElement("input",{className:"ui-selector-input",ref:(a)=>{this.pageInput=a},placeholder:locales.config.SELECT_DEFAULT_PAGE,value:this.state.pathName,onChange:this.onPagePathChange,onFocus:this.onPageDropDownClick,onBlur:this.onContainerClick}),React.createElement("div",{className:"ui-selector-dropdown",onClick:this.onAllPageDropDownClick,style:{display:a.pages&&0<a.pages.length?"":"none"}},React.createElement("i",{className:classNames({"ui-icon-arrow-down-o":!this.state.dropDownShow||"page"!==this.state.dropDownType,"ui-icon-arrow-up-o":this.state.dropDownShow&&"page"===this.state.dropDownType})}))))),React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label"},locales.config.STARTUP_PARAMETERS),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-selector ui-selector-primary"},React.createElement("input",{className:"ui-selector-input",value:this.state.query,"data-type":"query",placeholder:`${locales.config.FOR_EXAMPLE}：name=vendor&color=black`,onChange:this.onInputChange})))),React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label"},locales.config.ENTER_SCENE),React.createElement("div",{className:"ui-form-controls",onClick:this.onSceneDropDownClick},React.createElement("div",{className:"ui-selector ui-selector-default"},React.createElement("input",{className:"ui-selector-input",ref:(a)=>{this.sceneInput=a},placeholder:locales.config.DEFAULT,value:this.state.sceneWording,onChange:this.onSceneChange,onFocus:this.onSceneDropDownClick,onBlur:this.onContainerClick}),React.createElement("div",{className:"ui-selector-dropdown",onClick:this.onAllSceneDropDownClick},React.createElement("i",{className:classNames({"ui-icon-arrow-down-o":!this.state.dropDownShow||"scene"!==this.state.dropDownType,"ui-icon-arrow-up-o":this.state.dropDownShow&&"scene"===this.state.dropDownType})}))))),React.createElement("div",{className:"ui-form-item ui-form-item-inline",style:this.state.groupFormShow?{}:cssConfig.displayNone},React.createElement("label",{className:"ui-form-label"},locales.config.SELECT_GROUP),React.createElement("div",{className:"ui-form-controls",onClick:this.onGroupDropDownClick},React.createElement("div",{className:"ui-selector ui-selector-primary"},React.createElement("input",{className:"ui-selector-input",placeholder:locales.config.PLEASE_SELECT,readOnly:!0,value:this.state.groupWording}),React.createElement("div",{className:"ui-selector-dropdown"},React.createElement("i",{className:classNames({"ui-icon-arrow-down-o":!this.state.dropDownShow||"group"!==this.state.dropDownType,"ui-icon-arrow-up-o":this.state.dropDownShow&&"group"===this.state.dropDownType})}))))),React.createElement("div",{className:"ui-form-item ui-form-item-inline",style:this.couldInputAppId(this.state.scene)?{}:cssConfig.displayNone},React.createElement("label",{className:"ui-form-label"},locales.config.SET," appid"),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text","data-type":"appId",value:this.state.appId,onChange:this.onInputChange,placeholder:locales.config.STARTED_APPID,className:"ui-input"})))),React.createElement("div",{className:"ui-form-item ui-form-item-inline",style:this.couldInputExtralData(this.state.scene)?{}:cssConfig.displayNone},React.createElement("label",{className:"ui-form-label"},locales.config.SET," extraData"),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text",ref:(a)=>{this.extraInput=a},value:this.state.extraData,onChange:this.changeExtraData,className:"ui-input"}))),React.createElement("p",{style:this.state.extraDataErr?{}:cssConfig.displayNone}," ",this.state.extraDataErr," ")),React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label"}),React.createElement("div",{className:"ui-form-controls"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSimulateUpdateChange},React.createElement("i",{className:this.state.simulateUpdate?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.SIMULATION_UPDATE_AT_COMPILE_DETAIL.format("1.9.90"))))))),React.createElement("div",{className:"ui-dialog-ft"},React.createElement("div",{className:"ui-dialog-action"},React.createElement("button",{className:"ui-button ui-button-warn",style:b,onClick:this.onDelete},locales.config.DELETE_THIS_MODE)),React.createElement("div",{className:"ui-dialog-action"},React.createElement("button",{className:"ui-button ui-button-default",onClick:this.onClose},locales.config.CANCEL),React.createElement("button",{className:"ui-button ui-button-primary",onClick:this.onConfirm},locales.config.CONFIRM)))))}};CustomCompile=tslib_1.__decorate([locales.mixin],CustomCompile),module.exports=connect(mapStateToProps,mapDispatchToProps)(CustomCompile);
;}(require("lazyload"), require);
