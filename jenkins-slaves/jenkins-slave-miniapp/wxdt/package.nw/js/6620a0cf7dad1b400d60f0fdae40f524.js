'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(a,b){try{let c=b.filename,d=b.error.stack;i.error(`filename: ${c}, msg: ${d}`),h(a,'',`filename: ${c}, msg: ${d}`)}catch(a){}}const b=require('react'),c=require('react-dom'),{Provider:d}=require('react-redux'),e=directRequire('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),f=require('./db2217eb4cff896bdcbc50abe005058f.js'),g=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),h=require('./da7c31daaf542cf1796023d8e344b98a.js'),i=require('./72653d4b93cdd7443296229431a7aa9a.js'),j=require('./5451dfc4d939398d913dc724d952b02b.js'),k='darwin'===process.platform;class l extends b.Component{constructor(a){super(a),this.state={mount:!0}}render(){return this.state.mount?b.createElement('div',_extends({},this.props,{style:{width:'100%',height:'100%'}}),this.props.children):b.createElement('div',null)}}module.exports=class extends b.Component{constructor(a){super(a),this.queue=[],this.container=void 0}componentDidMount(){nw.Window.open(this.props.templateHTML||'html/popup.html',this.getWindowOptions(),(g)=>{if(this.unmounted)return void g.close(!0);k&&j.init(g);const h=global.Win.window,i=g.window;i.parent=h,this.child=g,this.registryId=this.props.registryId||`${this.props.title}_${+new Date}`,f.register({id:this.registryId,window:g}),global.windowMap.set(this.registryId,g),g.on('close',()=>{try{g.hide();const a=g.window.document.querySelectorAll('webview');for(const b of a)b.style.display='none'}catch(a){}try{this.props.onWindowClose&&this.props.onWindowClose(),this.child&&this.child.window.onWindowClose&&this.child.window.onWindowClose()}catch(a){}this.closeWindow()}),global.appConfig.isDev||i.addEventListener('error',(b)=>{a('tool_error_web',b)});const m=document.createElement('body'),n=document.createElement('div');if(n.style.cssText='width: 100%; height: 100%;',this.props.className&&(n.className=this.props.className),m.appendChild(n),i.document.body=m,this.container=n,m.addEventListener('dragover',function(a){a.preventDefault(),a.stopPropagation()},!1),m.addEventListener('drop',function(a){a.preventDefault(),a.stopPropagation()},!1),this.setTheme(this.props.theme),this.props.devtools){if(this.queue&&0<this.queue.length){this.child.window;this.queue.forEach((a)=>{this.container.appendChild(a)}),this.queue=[]}this.props.onReady&&this.props.onReady(g)}else if(this.props.children)c.render(b.createElement(d,{store:e},b.createElement(l,_extends({ref:(a)=>this.dummy=a},this.props.wrapperProps),this.props.children)),n,()=>{this.props.onReady&&this.props.onReady(g)});else{const a=this.props.renderClass,f=this.props.renderProps||{};c.render(b.createElement(d,{store:e},b.createElement(l,_extends({ref:(a)=>this.dummy=a},this.props.wrapperProps),b.createElement(a,_extends({},f,{win:g})))),n,()=>{this.props.onReady&&this.props.onReady(g)})}})}componentWillUnmount(){this.unmounted=!0,this.closeWindow(),k&&j.init(global.Win)}componentWillReceiveProps(a){a.theme!=this.props.theme&&this.setTheme(a.theme)}setTheme(a){const b=this.child.window,c=b.document.body;'dark'!==a||c.classList.contains('dark')||c.classList.add('dark'),'dark'!==a&&c.classList.contains('dark')&&c.classList.remove('dark')}closeWindow(){if(this.registryId)try{f.unregister(this.registryId),global.windowMap.delete(this.registryId)}catch(a){}const a=()=>{try{this.child.close(!0),j.unSubscribeUpdate(this.child),this.child=null}catch(a){}};if(this.dummy)try{this.dummy.setState({mount:!1},()=>{a()})}catch(b){a()}else this.child&&a()}appendChild(a){if(a&&this.queue.push(a),!this.child)return;const b=this.child.window;this.queue.forEach((a)=>{this.container?this.container.appendChild(a):b.document.body.appendChild(a)}),this.queue=[]}getWindowOptions(){return function(a){const b={};for(const c of a)this.props.hasOwnProperty(c)&&(b[c]=this.props[c]);return b.title||(b.title=nw.App.manifest.window.title,this.props.projectName&&(b.title=`${decodeURIComponent(this.props.projectName)} - ${b.title}`)),b.width||(b.width=g.SIZE.DEFAULT.WIDTH),b.height||(b.height=g.SIZE.DEFAULT.HEIGHT),b.hasOwnProperty('focus')||(b.focus=!0),b}.bind(this)(['id','title','icon','position','focus','always_on_top','width','height','min_width','min_height','max_width','max_height','resizable','kiosk','fullscreen','show_in_taskbar','frame','transparent'])}render(){return b.createElement('div',{style:{display:'none'}})}}}(require('lazyload'),require);