;!function(require, directRequire){;"use strict";const tslib_1=require("tslib"),fs=require("fs"),path=require("path"),React=require("react"),moment=require("moment"),classNames=require("classnames"),cssConfig=require('./3b5f8e2469c474c8d433c1c6926d8999.js'),ProjectSetting=require('./4247893aa775b1bbd1b33272249f2906.js'),ProjectConfig=require('./efca46d675165423879efe144504d758.js'),ProjectQcloud=require('./ae7839ba7720ad42a8e26fcddb5eec71.js'),SubpackgePopover=require('./3c4d32722656d6db4b4378ce9114631b.js'),PluginPopover=require('./412d5c88ae1629af2abf1c3e837de385.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js'),fileSystem=require('./f6cbcecf6ed9f533f6a506310d8f07b6.js'),checkAppConfig=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),projectManager=require('./3bfffbe88b3d923921f851c0697974fe.js'),getOnlinePlugin=require('./2d8c17f8789be1869edbd369314f5eaa.js'),vendorManager=require('./d28a711224425b00101635efe1034c99.js'),stringUtils=require('./2254692212b7d32a3c1405f399460682.js'),locales=require('./common/locales/index.js'),defaultsConfig=require('./5498e660c05c574f739a28bd5d202cfa.js'),{getWeappCodeSize}=require('./3bfffbe88b3d923921f851c0697974fe.js'),SUBPACKAGE_SIZE_TYPE={NONE:"none",LOCAL:"local",PREVIEW:"preview",UPLOAD:"upload"};let ProjectInfo=class extends React.Component{constructor(a){super(a),this.onPannelClick=(a)=>{a.stopPropagation(),this.resetPopover()},this.resetPopover=()=>{this.setState({showDropDown:!1,subpackagesInfo:Object.assign({},this.state.subpackagesInfo,{show:!1}),pluginPopoverInfo:Object.assign({},this.state.pluginPopoverInfo,{show:!1})})},this.handleDropdownShow=()=>{this.setState({showDropDown:!0})},this.onFileSystemClick=(a)=>{a.stopPropagation();const b=this.props.project,c=fileSystem.getFileSystemDir(b);nw.Shell.openItem(c)},this.onOpenDirClick=(a)=>{a.stopPropagation();const b=this.props.project.projectpath;fs.existsSync(b)&&nw.Shell.openItem(b)},this.onCopyAppid=(a)=>{a.stopPropagation();const b=this.props.project||{},c=nw.Clipboard.get();c.set(b.appid,"text"),this.props.showSuccessTip(locales.config.CONSOLE_COPY_SUCCESS)},this.onChangeAppid=(a)=>{a.stopPropagation(),this.props.infoActions.setChangeAppIdInfo({show:!0}),report("change_appid",!0)},this.onShowPluginInfoClick=(a)=>{a.stopPropagation();const b=this.pluginInfoLabel.getBoundingClientRect(),c=`${b.top-50}px`;this.setState({pluginPopoverInfo:Object.assign({},this.state.pluginPopoverInfo,{show:!0,top:c})})},this.onAnimationEnd=()=>{"hide"===this.state.animationType&&this.setState({show:!1})},this.state={lazyLoaded:a.show,show:a.show,animationType:a.show?"show":"none",codePackageLength:0,hasSubpackage:!1,subPackagesLengthInfo:null,subpackagesInfo:{show:!1,type:SUBPACKAGE_SIZE_TYPE.NONE},hasPlugin:!1,pluginPopoverInfo:{show:!1}}}componentDidMount(){this.props.show&&(this.getCodePackageLength(),this.checkHasSubpackage(),this.updatePluginInfo())}componentWillReceiveProps(a){a.show!==this.props.show&&(a.show?(("qcloud"===a.selected||"config"===a.selected)&&this.props.requestProjectAttr(!0),"setting"===a.selected&&this.props.getPublicLibUsageRate(),this.getCodePackageLength(),vendorManager.updateInfos(),this.checkHasSubpackage(),this.updatePluginInfo(),this.setState({show:!0,animationType:"show",lazyLoaded:!0})):(this.resetPopover(),this.setState({animationType:"hide"})))}shouldComponentUpdate(a,b){return b.show!==this.state.show||this.state.show}checkHasSubpackage(){setTimeout(async()=>{const a=await checkAppConfig(this.props.project);a.subPackages?!this.state.hasSubpackage&&this.setState({hasSubpackage:!0}):this.state.hasSubpackage&&this.setState({hasSubpackage:!1})})}updatePluginInfo(){setTimeout(async()=>{const a=await projectManager.getLatestPluginInfo(this.props.project);if(a&&a.length)for(const b of a)b.current&&!b.current.pkgSize&&(b.current.pkgSize=getOnlinePlugin.getSize(b.appid,b.current.version));if(this.props.setPluginInfo(a),a&&a.length){let b=locales.config.PLUGINS_POSTFIX.format(a.length),c=!1;for(const b of a)if((b.current||{}).version!==(b.latest||{}).version){c=!0;break}c&&(b=locales.config.PLUGINS_UPDATE_INFO.format(a.length)),this.setState({hasPlugin:!0,pluginPopoverInfo:Object.assign({},this.state.pluginPopoverInfo,{statusText:b,items:a})})}else this.setState({hasPlugin:!1,pluginPopoverInfo:Object.assign({},this.state.pluginPopoverInfo,{show:!1})})})}onTabSelect(a){this.props.infoActions.setProjectInfo({selected:a}),("config"===a||"qcloud"===a)&&(this.props.requestProjectAttr(!0),"qcloud"===a&&report("weapp_toolbar_details_qcloud",this.props.project.appid))}onCopyShareLinkClick(a,b){a.stopPropagation();const c=this.props.project||{},d=nw.Clipboard.get();d.set(b,"text"),this.props.showSuccessTip(locales.config.CONSOLE_COPY_SUCCESS)}onShowsubpackagesInfoClick(a,b){switch(a.stopPropagation(),b){case"local":{if(this.state.subPackagesLengthInfo&&1<Object.keys(this.state.subPackagesLengthInfo).length){if(!this.localSubpackgesLabel)return;const a=this.localSubpackgesLabel.getBoundingClientRect(),b=`${a.top-50}px`,c=this.state.subPackagesLengthInfo;this.setState({subpackagesInfo:{top:b,show:!0,title:locales.config.LOCAL_SUBPACKAGE_CODE_SIZE,type:SUBPACKAGE_SIZE_TYPE.PREVIEW,items:Object.keys(c).sort((a,b)=>a<b).map((a)=>{return"__APP__"===a?{name:locales.config.MAIN_PACKAGE,size:`${c[a]} KB`}:{name:a,size:`${c[a]} KB`}})}})}else this.setState({subpackagesInfo:{show:!1}});break}case"preview":{if(this.props.pkgSize.previewSubpackages&&0<this.props.pkgSize.previewSubpackages.length){if(!this.previewSubpackagesLabel)return;const a=this.previewSubpackagesLabel.getBoundingClientRect(),b=`${a.top-50}px`;this.setState({subpackagesInfo:{top:b,show:!0,title:locales.config.LAST_PREVIEW_SUBPACKAGE_SIZE,type:SUBPACKAGE_SIZE_TYPE.PREVIEW,items:this.props.pkgSize.previewSubpackages.sort((a,b)=>a.name<b.name).map((a)=>{return"__APP__"===a.name?{name:locales.config.MAIN_PACKAGE,size:`${(a.size/1024).toFixed(1)} KB`}:{name:a.name,size:`${(a.size/1024).toFixed(1)} KB`}})}})}else this.setState({subpackagesInfo:{show:!1}});break}case"upload":{if(this.props.pkgSize.uploadSubpackages&&0<this.props.pkgSize.uploadSubpackages.length){if(!this.uploadSubpackagesLabel)return;const a=this.uploadSubpackagesLabel.getBoundingClientRect(),b=`${a.top-50}px`;this.setState({subpackagesInfo:{top:b,show:!0,title:locales.config.LAST_UPLOAD_SUBPACKAGE_SIZE,type:SUBPACKAGE_SIZE_TYPE.UPLOAD,items:this.props.pkgSize.uploadSubpackages.sort((a,b)=>a.name<b.name).map((a)=>{return"__APP__"===a.name?{name:locales.config.MAIN_PACKAGE,size:`${(a.size/1024).toFixed(1)} KB`}:{name:a.name,size:`${(a.size/1024).toFixed(1)} KB`}})}})}else this.setState({subpackagesInfo:{show:!1}});break}default:}}async getCodePackageLength(){const{total:a,subPackages:b}=await getWeappCodeSize(this.props.project);this.setState({codePackageLength:a,subPackagesLengthInfo:b})}render(){var a=Math.round;if(!this.state.lazyLoaded)return null;const b=this.props,c=this.state,d=b.project||{},e=d.runtimeAttr||{},f=d.attr||{},g=e.appImageUrl||defaultsConfig.default_weapp_header,h=`tab-hd-item ${"setting"===b.selected?"tab-hd-item-active":""}`,i=`tab-hd-item ${"config"===b.selected?"tab-hd-item-active":""}`,j=`tab-hd-item ${"qcloud"===b.selected?"tab-hd-item-active":""}`,k=e.qcloud&&e.qcloud.qcloud_status&&1===e.qcloud.qcloud_status.open_qc_account;let l;d.shareInfo&&d.shareInfo.history&&d.shareInfo.history[0]&&(l=d.shareInfo.history[0]);const m=f.platform&&e.isExtAppId&&`${e.appid} ${e.extAppIdErrMsg||""}`,n=fileSystem.getFileSystemDir(d)||"",o=d.appid;return React.createElement("div",{className:classNames("panel panel-pull-right",{"ui-animate-swipeInLeft":"show"===c.animationType,"ui-animate-swipeOutRight":"hide"===c.animationType}),style:c.show?{}:cssConfig.displayNone,onAnimationEnd:this.onAnimationEnd,onClick:this.onPannelClick},React.createElement("div",{className:"project"},React.createElement("div",{className:"project-hd",style:{userSelect:"initial"}},React.createElement("div",{className:"ui-flex"},React.createElement("div",{className:"project-avatar"},React.createElement("img",{src:g,alt:""})),React.createElement("h3",{className:"project-name"},e.appName||decodeURIComponent(d.projectname))),React.createElement("div",{className:"project-summary"},React.createElement("div",{className:"ui-flex",style:f.platform&&f.platformNickname?{}:cssConfig.displayNone},React.createElement("label",null,locales.config.PLATFORM_NAME),React.createElement("p",{className:"ui-flex-item"},f.platformNickname)),React.createElement("div",{className:"ui-flex",style:m?{}:cssConfig.displayNone},React.createElement("label",null,"extAppid"),React.createElement("p",{className:"ui-flex-item"},m)),React.createElement("div",{className:"ui-flex"},React.createElement("label",null,"AppID"),React.createElement("p",{className:"ui-flex-item"},o),React.createElement("a",{onClick:this.onChangeAppid},locales.config.MODIFY),React.createElement("a",{onClick:this.onCopyAppid},locales.config.COPY)),React.createElement("div",{className:"ui-flex"},React.createElement("label",null,locales.config.LOCAL_DIRECTORY),React.createElement("p",{className:"ui-flex-item",title:d.projectpath},d.projectpath),React.createElement("a",{onClick:this.onOpenDirClick},locales.config.OPEN)),React.createElement("div",{className:"ui-flex",style:{}},React.createElement("label",null,locales.config.FILE_SYSTEM),React.createElement("p",{className:"ui-flex-item",title:n},n),React.createElement("a",{onClick:this.onFileSystemClick},locales.config.OPEN)),React.createElement("div",{className:"ui-flex",style:{position:"relative"},onClick:(a)=>this.onShowsubpackagesInfoClick(a,"local"),ref:(a)=>this.localSubpackgesLabel=a},React.createElement("label",null,locales.config.LOCAL_CODE),React.createElement("p",{className:"ui-flex-item"},this.state.codePackageLength," KB",this.state.hasSubpackage?React.createElement("i",{className:"ui-icon-arrow-down"}):null)),React.createElement("div",{className:"ui-flex",style:{position:"relative"},onClick:(a)=>this.onShowsubpackagesInfoClick(a,"preview"),ref:(a)=>this.previewSubpackagesLabel=a},React.createElement("label",null,locales.config.LAST_PREVIEW),React.createElement("p",{className:"ui-flex-item"},0<=this.props.pkgSize.preview?`${a(this.props.pkgSize.preview/1024)} KB（${moment(new Date(this.props.pkgSize.lastPreviewTime)).calendar()}）`:locales.config.NONE,this.state.hasSubpackage?React.createElement("i",{className:"ui-icon-arrow-down"}):null)),d.isMiniCode?null:React.createElement("div",{className:"ui-flex",style:{position:"relative"},onClick:(a)=>this.onShowsubpackagesInfoClick(a,"upload"),ref:(a)=>this.uploadSubpackagesLabel=a},React.createElement("label",null,locales.config.LAST_UPLOAD),React.createElement("p",{className:"ui-flex-item"},0<=this.props.pkgSize.upload?`${a(this.props.pkgSize.upload/1024)} KB（${moment(new Date(this.props.pkgSize.lastUploadTime)).calendar()}）`:locales.config.NONE,this.state.hasSubpackage?React.createElement("i",{className:"ui-icon-arrow-down"}):null)),this.state.hasPlugin?React.createElement("div",{className:"ui-flex",style:{position:"relative"},onClick:this.onShowPluginInfoClick,ref:(a)=>this.pluginInfoLabel=a},React.createElement("label",null,locales.config.PLUGIN_INFORMATION),React.createElement("p",{className:"ui-flex-item"},this.state.pluginPopoverInfo.statusText,React.createElement("i",{className:"ui-icon-arrow-down"}))):null,d.isMiniCode&&d.shareInfo&&d.shareInfo.from&&d.shareInfo.from.codeid?React.createElement("div",{className:"ui-flex"},React.createElement("label",null,locales.config.SOURCE_LINK),React.createElement("p",{className:"ui-flex-item"},stringUtils.getMiniCodeLink(d.shareInfo.from.codeid)),React.createElement("a",{onClick:(a)=>this.onCopyShareLinkClick(a,stringUtils.getMiniCodeLink(d.shareInfo.from.codeid))},locales.config.COPY)):null,d.isMiniCode?React.createElement("div",{className:"ui-flex"},React.createElement("label",null,locales.config.LAST_SHARE),React.createElement("p",{className:"ui-flex-item"},l?stringUtils.getMiniCodeLink(l.codeid):locales.config.NONE),React.createElement("a",{onClick:(a)=>l&&this.onCopyShareLinkClick(a,stringUtils.getMiniCodeLink(l.codeid))},locales.config.COPY)):null,this.state.subpackagesInfo.show?React.createElement(SubpackgePopover,{title:this.state.subpackagesInfo.title,items:this.state.subpackagesInfo.items,top:this.state.subpackagesInfo.top,onCancel:this.resetPopover}):null,this.state.pluginPopoverInfo.show?React.createElement(PluginPopover,{items:this.state.pluginPopoverInfo.items,top:this.state.pluginPopoverInfo.top,onCancel:this.resetPopover}):null)),React.createElement("div",{className:"project-bd"},React.createElement("div",{className:"tab"},React.createElement("div",{className:"tab-hd"},React.createElement("div",{className:h,onClick:this.onTabSelect.bind(this,"setting")},locales.config.PROJECT_SETTINGS),React.createElement("div",{className:i,onClick:this.onTabSelect.bind(this,"config")},locales.config.DOMAIN_INFORMATION),!d.isMiniCode&&k?React.createElement("div",{className:j,onClick:this.onTabSelect.bind(this,"qcloud")},locales.config.TENCENT_CLOUD_STATUS):null),React.createElement("div",{className:"tab-bd"},React.createElement(ProjectSetting,{showDropDown:this.state.showDropDown,onDropdownShow:this.handleDropdownShow}),React.createElement(ProjectConfig,null),React.createElement(ProjectQcloud,null))))))}};ProjectInfo=tslib_1.__decorate([locales.mixin],ProjectInfo),module.exports=ProjectInfo;
;}(require("lazyload"), require);
