;!function(require, directRequire){;'use strict';const path=require('path'),React=require('react'),{connect}=require('react-redux'),PropTypes=require('prop-types'),C=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),windowActions=require('./a8c87029da0fa06e986298d447ab0fe2.js'),menu=require('./5451dfc4d939398d913dc724d952b02b.js'),Simulator=require('./584aae91d7c83393222029103ba1ac29.js'),Toolbar=require('./055004f0a032321f42398fa2eaeb938d.js'),CustomCompile=require('./0ac4da1c7ab84710f2c94e3bf0cf4861.js'),AppService=require('./b1ba6dfcea5ed09bd8f7edf39a8149d6.js'),GameSimulator=require('./a254abb81b6346b59aa82a08652fe610.js'),GameDevtools=require('./d51f6457067a06cf51fac263b2c25b60.js'),Confirm=require('./bf5bd8b977a68a4f788a29b92aa86a0e.js'),loadConfig=require('./dc59f57d54946e61d27c95ab24d8cb4f.js'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),compileTypeConfig=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),configActions=require('./3b66d845db4d098b7a16cb0357f5c072.js'),clickkeyConfig=require('./eadce02c750c875a10680bcfedadec88.js'),rootActions=require('./37d8b9297fb1bd87f9a3ac407b8006a0.js'),projectActions=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),SuccessTip=require('./f4b122ca93225892eb1487c959c929f6.js'),fileUtils=require('./d62fc37d7aa6416d5dcc240ba94175cd.js'),AddDevice=require('./106eac0139723db6a35b934f19cb4aa5.js'),Music=require('./03b7faa8f76486fc3878b17c9a674a7e.js'),musicstatusConfig=require('./5dc59f418d85e854c1a12d402d29e2d7.js'),infoActions=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),idepluginManager=require('./f5a748840b272d2bf0223c95f6c8dbe3.js'),projectConfigJsonUtil=require('./42191d95974f14b18961c9f2c730464e.js'),locales=require('./common/locales/index.js'),onBeforeSendHeaders=require('./ffc9a3cdcc5036d1fb62a2324c72a2b0.js'),mapStateToProps=(a)=>{const b=a.window.debug||{},c=a.window.simulator||{},d=a.info.confirmInfo||{},e=a.toolbar.deviceInfo||{},f=a.toolbar.clickKey,g=a.simulator.music&&a.simulator.music.status;return{debuggerHeight:global.isSimple?'100%':b.height||100,simulatorWindowWidth:c.width||500,workbenchShow:b.show,simulatorShow:c.show,simulatorPosition:c.position,deviceWidth:e.screenWidth,deviceHeight:e.screenHeight,addDeviceShow:a.info.addDeviceInfo&&a.info.addDeviceInfo.show,clickkey:f,confirmShow:d.show,maskType:a.window.mask.show?a.window.mask.type:'',project:a.project.current||{},windowStatus:a.window.windowStatus,musicShow:g===musicstatusConfig.MUSIC_STATE_PLAY||g===musicstatusConfig.MUSIC_STATE_PAUSE,theme:a.settings.appearance.theme||'white'}},mapDispatchToProps=(a)=>({bodyClick:tools.bindActionCreators(rootActions.bodyClick,a),recordFocus:tools.bindActionCreators(windowActions.recordFocus,a),maximizeWindow:tools.bindActionCreators(windowActions.appMax,a),requestProjectAttr:tools.bindActionCreators(projectActions.requestProjectAttr,a),windowActions:tools.bindActionCreators(windowActions,a),updateSceneConfig:tools.bindActionCreators(configActions.updateSceneConfig,a),setProjectConfig:tools.bindActionCreators(projectActions.setProjectConfig,a),setPluginManifests:tools.bindActionCreators(configActions.setPluginManifests,a),confirm(b,c){a(infoActions.setConfirmInfo(Object.assign({show:!0,showCancel:!1,callback:c},b)))}});class Main extends React.Component{constructor(a){super(a),this.onResize=(a,b)=>{this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.props.windowActions.appResize({width:a,height:b}),this.resizeTimer=null},20)},this.onBodyClick=(a)=>{this.props.clickkey!==clickkeyConfig.NONE&&this.props.bodyClick(a),a.target.partition?'persist:editor'===a.target.partition?this.props.recordFocus(C.WINDOW_FOCUS.EDITOR):'persist:devtools'===a.target.partition?this.props.recordFocus(C.WINDOW_FOCUS.DEVTOOLS):'persist:remotedebugdevtools'===a.target.partition&&this.props.recordFocus(C.WINDOW_FOCUS.REMOTE_DEBUG_DEVTOOLS):this.props.recordFocus(C.WINDOW_FOCUS.BODY)},this.lastWorkbenchShowWindowWidth=0,this._onConfigUpdate=this.onConfigUpdate.bind(this)}componentDidMount(){if(this.props.win||global.isDevWindow){const a=this.props.win||global.Win;global.windowMap.set('MAIN',a),global.online||a.setMinimumSize(C.MIN_MAIN_WINDOW_WIDTH,C.MIN_MAIN_WINDOW_HEIGHT),a.on('resize',this.onResize),menu.init(a),menu.update(),a.title=`${global.userInfo.nickName} - ${global.devInfo.projectname}`}const a=loadConfig.get();a&&a.scene&&this.props.updateSceneConfig(a),loadConfig.on('CONFIG_UPDATE',this._onConfigUpdate),this.props.requestProjectAttr(!1),this.watchProjectConfig(),onBeforeSendHeaders.addListener();try{const a=idepluginManager.getInstalledPluginManifest();this.props.setPluginManifests(a)}catch(a){}}componentWillUnmount(){loadConfig.off('CONFIG_UPDATE',this._onConfigUpdate),onBeforeSendHeaders.removeListener()}componentWillReceiveProps(a){a.workbenchShow!==this.props.workbenchShow&&(a.workbenchShow?global.Win.width=Math.max(this.lastWorkbenchShowWindowWidth,global.Win.width,a.simulatorWindowWidth+100):(this.lastWorkbenchShowWindowWidth=global.Win.width,global.Win.width=a.simulatorWindowWidth)),a.theme!==this.props.theme&&setTimeout(()=>{this.setTheme()})}getChildContext(){return{currentNWWindow:this.props.win?this.props.win:global.Win}}async watchProjectConfig(){const a=this.props.project;this.projectFiles=await fileUtils(a.projectpath),this.projectFiles.on('all',(b,c)=>{c=path.relative(a.projectpath,c),'project.config.json'===c&&this.projectConfigFileChanged()}),this.projectConfigFileChanged()}async projectConfigFileChanged(){const a=this.props.project,b=projectConfigJsonUtil.getConfigFileInfo(a);if(!b.error)this.props.setProjectConfig(b.config,{needCheckAppid:!1,needConfirmToChangeAppid:!1});else{let a=null;'readerror'===b.error.type?a={title:'',content:locales.config.PROJECT_CONFIG_READ_ERROR,showCancel:!1}:'parseerror'===b.error.type?a={title:'',content:locales.config.PROJECT_CONFIG_PARSE_ERROR,showCancel:!1}:'contenterror'===b.error.type&&(a={title:'',content:locales.config.PROJECT_CONFIG_CONTENT_ERROR.format(b.error.message),showCancel:!1}),a&&this.props.confirm(a)}}checkWindowStatus(){const a=this.props.windowStatus.mode;if(a===C.WINDOW_MODE.FULLSCREEN)this.props.win.enterFullscreen();else if(a===C.WINDOW_MODE.WINDOW_MAXIMIZE)this.props.win.maximize();else if(a===C.WINDOW_MODE.FREE){const a=this.props.windowStatus.position;this.props.win.moveTo(a.x,a.y),this.props.win.resizeTo(a.width,a.height)}}onConfigUpdate(a){this.props.updateSceneConfig(a)}onAboutClick(){this.props.windowActions.setAboutWindow({show:!0})}getSimulator(a){const b=this.props;let c=b.simulatorWindowWidth;return b.simulatorShow?!b.workbenchShow&&(c='100%'):c=0,b.project.attr&&b.project.attr.gameApp?React.createElement(GameSimulator,{width:c}):a===compileTypeConfig.weapp||a===compileTypeConfig.plugin?React.createElement(Simulator,{width:c}):null}getService(a){const b=this.props,c=b.debuggerHeight;if(b.project.attr&&b.project.attr.gameApp)return React.createElement(GameDevtools,{height:c});return a===compileTypeConfig.weapp||a===compileTypeConfig.plugin?React.createElement(AppService,{height:c}):null}getOptionsComponents(){const a=this.props,b=[];return a.addDeviceShow&&b.push(React.createElement(AddDevice,{key:'adddevice'})),a.musicShow&&b.push(React.createElement(Music,{key:'music'})),a.confirmShow&&b.push(React.createElement(Confirm,{key:'confirm'})),b}setTheme(){clearTimeout(this.setThemeTimer),this.setThemeTimer=setTimeout(()=>{const{theme:a}=this.props,b=[document.body,global.contentDocument.body];b.forEach((b)=>{const c=b.classList.contains('dark');'dark'!==a||c||b.classList.add('dark'),'white'===a&&c&&b.classList.remove('dark')})})}render(){const a=this.props,b=a.project.compileType;let c='workbench';a.workbenchShow||(c+=' ui-invisible');let d=null;return this.props.maskType&&this.props.maskType===C.MASK_TYPE.GLOBAL_BLOCKING&&(d=React.createElement('div',{className:'ui-mask ui-mask-transparent'})),React.createElement('div',null,React.createElement('div',{style:{height:'inherit',width:'100%'},onClick:this.onBodyClick},React.createElement(Toolbar,null),React.createElement('div',{className:'left'===a.simulatorPosition?'main':'main main-reverse'},React.createElement(CustomCompile,{compileType:b,project:this.props.project}),this.getOptionsComponents(),React.createElement('div',{onMouseDown:this.onBodyClick,style:{width:a.workbenchShow?'inherit':'100%'}},this.getSimulator(b)),React.createElement('div',{className:c,onMouseDown:this.onBodyClick},React.createElement('div',{className:'monaco ui-invisible',tabIndex:-1,style:{minHeight:97}}),this.getService(b))),React.createElement(SuccessTip,null),d))}}Main.childContextTypes={currentNWWindow:PropTypes.object},module.exports=connect(mapStateToProps,mapDispatchToProps)(Main);
;}(require("lazyload"), require);
