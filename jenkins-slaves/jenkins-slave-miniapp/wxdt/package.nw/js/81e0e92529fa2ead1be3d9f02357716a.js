;!function(require, directRequire){;"use strict";const React=require("react"),{enterBackground,enterForeground}=require('./a3959bb900db9f65ed2e9c5dfa6977b7.js'),{weappStoreFileReqular,weappTmpFileReqular,weappUsrFileReqular,weappOpendataFileRegular}=require('./6242f55dbdfe53c2f07b7a51568311f2.js');class PreviewImage extends React.Component{constructor(a){super(a),this.onMouseDown=(a)=>{this.startX=a.pageX,this.touch=!0,this.lastTranslateX=this.state.translateX},this.onMouseMove=(a)=>{if(!this.touch)return;let b=a.pageX-this.startX+this.lastTranslateX;b=Math.min(0,b),b=Math.max((1-this.props.urls.length)*this.props.width,b),this.setState({translateX:b}),this.moved=!0},this.onMouseUp=()=>{this.startX=0,this.touch=!1,this.setState({translateX:parseInt(this.state.translateX/this.props.width-0.5+"",10)*this.props.width}),setTimeout(()=>{this.moved=!1})},this.onMouseEnter=()=>{},this.onClick=()=>{this.moved||this.hide()},this.state={translateX:0,backgroundImageUrls:(a.urls||[]).map(()=>"")},this.moved=!1,this.touch=!1,this.startX=0,this.lastTranslateX=0}componentDidMount(){enterBackground("previewImage");const a=this.props.current,b=this.props.urls||[];let c=b.indexOf(a);c=Math.max(c,0),this.setState({translateX:-c*this.props.width,backgroundImageUrls:b.map(()=>"")}),setTimeout(()=>this.loadImages(b))}componentWillUnmount(){enterForeground("previewImage")}loadImages(a){for(let b,c=0,d=a.length;c<d;c++){b=a[c],"string"==typeof b&&0<=b.indexOf("wxfile://")?b=b.replace("wxfile://","http://wxfile.open.weixin.qq.com/"):(weappStoreFileReqular.test(b)||weappTmpFileReqular.test(b)||weappUsrFileReqular.test(b)||weappOpendataFileRegular.test(b))&&(b=b.replace(/^https?:\/\//,`$&127.0.0.1:${global.proxyPort}/`));const d=()=>{e.removeEventListener("load",d);const a=[...this.state.backgroundImageUrls];a.splice(c,1,b),this.setState({backgroundImageUrls:a})},e=document.createElement("img");e.addEventListener("load",d),e.setAttribute("src",b)}}hide(){this.props.hidePreviewImage()}render(){const a=this.props,b={display:"block",transition:"all linear 0.3s",width:`${100*a.urls.length}%`,transform:`translate(${this.state.translateX}px,0)`},c=a.urls.map((b,c)=>{const d=this.state.backgroundImageUrls[c];return React.createElement("span",{key:c,className:"weui-gallery__img",style:{backgroundImage:`url('${d}')`,width:a.width,left:c*a.width}},""===d?React.createElement("div",{className:"weui-gallery__loading"},React.createElement("i",{className:"weui-loading weui-icon_toast"})):null)});return React.createElement("div",{className:"weui-gallery",style:b,onClick:this.onClick,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseUp,onMouseEnter:this.onMouseEnter},c)}}module.exports=PreviewImage;
;}(require("lazyload"), require);
