;!function(require, directRequire){;'use strict';const React=require('react'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),debuggerActions=require('./c4190a2430506f3602ca550e1e75d620.js'),windowActions=require('./a8c87029da0fa06e986298d447ab0fe2.js'),devtoolsMessager=require('./4762f28cad4425c4fc55dec009c87a7e.js'),C=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),messagecenter=require('./ff946754202ecf377034d29daac7c8d9.js'),{connect}=require('react-redux'),ABOUT_BLANK='about:blank',mapStateToProps=(a)=>{const b=a.webdebugger||{},c=a.toolbar.deviceInfo;return{device:c,dpr:c.dpr,height:c.screenHeight-c.navigationbarHeight-c.statusbarHeight,width:c.screenWidth,webview:b.webview,popup:a.window.debug.popup,theme:a.settings.appearance.devtoolsTheme}},mapDispatchToProps=(a)=>({debuggerActions:tools.bindActionCreators(debuggerActions,a),windowActions:tools.bindActionCreators(windowActions,a)});class Devtools extends React.Component{componentDidMount(){this.initWebview(),this._onDevtoolsMessage=this.onDevtoolsMessage.bind(this),devtoolsMessager.register(this._onDevtoolsMessage)}componentWillReceiveProps(a){a.webview!==this.props.webview&&a.webview&&setTimeout(()=>{this.showDevTools()}),a.device!==this.props.device&&setTimeout(()=>{this.setDevice()}),a.theme!==this.props.theme&&this.setDevtoolsTheme()}componentWillUnmount(){devtoolsMessager.unRegister(this._onDevtoolsMessage)}setDevtoolsTheme(){clearTimeout(this.setDevtoolsThemeTimer),this.setDevtoolsThemeTimer=setTimeout(()=>{const a='dark'===this.props.theme?'dark':'default';devtoolsMessager.send({command:'SET_THEME',data:a})})}onDevtoolsMessage(a){'Button.popup'===a.command?this.props.windowActions.setDebuggerWindow({popup:!this.props.popup}):'THEME_MODIFIED'===a.command&&this.onDevtoolsThemeModified()}onDevtoolsThemeModified(){this.devtoolsview.reload()}initWebview(){const a=this.devtoolsview=document.createElement('webview');a.setAttribute('partition','persist:devtools'),a.setAttribute('style','height:100%;width:100%;position:relative;');const b=`${a.getUserAgent()} devtoolsview port/${global.messageCenterPort}`;a.setUserAgentOverride(b),this.container.appendChild(a),this.props.webview&&this.showDevTools(),this.initEvent()}initEvent(){const a=this.devtoolsview;a&&(a.addEventListener('newwindow',this._newwindow),a.addEventListener('dialog',(a)=>{const b=a.messageType||'',c=a.messageText,d=c,e=a.dialog;if('prompt'===b)if(d===C.GET_MESSAGE_TOKEN)e.ok(messagecenter.getToken('HTMLWEBVIEWDEVTOOLS'));else if('GET_THEME'===c)e.ok('dark'===this.props.theme?'dark':'default');else if(null!==d){const a=prompt(c);e.ok(a)}else e.cancel()}))}setDevice(){const a=this.props;devtoolsMessager.send({command:'SET_DEVICE',data:{width:0,height:0,deviceScaleFactor:parseFloat(a.dpr),mobile:!0,fitWindow:!1,scale:1,screenHeight:parseInt(a.height,10),screenWidth:parseInt(a.width,10),positionX:0,positionY:0,screenOrientation:{angle:0,type:'portraitPrimary'}}})}_newwindow(a){a.preventDefault();let b=a.targetUrl;b&&('https://developers.google.com/web/tools/chrome-devtools/'===b&&(b='https://developers.weixin.qq.com/miniprogram/dev/index.html'),'https://developers.google.com/web/updates/2017/05/devtools-release-notes'===b&&(b='https://developers.weixin.qq.com/miniprogram/dev/devtools/uplog.html'),nw.Shell.openExternal(b))}showDevTools(){const a=this.props.webview,b=this.devtoolsview,c=()=>{b.removeEventListener('loadcommit',c);const d=()=>{a.removeEventListener('loadcommit',d),a.showDevTools(!0,b)};a.addEventListener('loadcommit',d),a.src='html/about.html'};b.addEventListener('loadcommit',c),b.addEventListener('contentload',()=>{this.setDevice()}),b.src=ABOUT_BLANK}render(){return React.createElement('div',{ref:(a)=>this.container=a,style:{flex:1,height:this.props.isPopup?'100%':'inherit'},className:'devtools'})}}module.exports=connect(mapStateToProps,mapDispatchToProps)(Devtools);
;}(require("lazyload"), require);
