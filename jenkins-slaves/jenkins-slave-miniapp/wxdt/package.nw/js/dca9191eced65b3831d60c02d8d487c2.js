'use strict';!function(require,directRequire){async function a(a,e,k){const l=d.getCurrent(),m=d.getCurrentRuntimeConfig();if(l.isTourist)return v.Allow;if(m&&m.permission&&m.permission[a]){const l=m.permission[a];if(0===l.state)return global.appConfig.isDev?v.Allow:v.NoAllow;if(1===l.state)return v.Allow;if(4===l.state){const{body:l}=await f({url:`${g.checkApiAuth}`,method:'post',needToken:1,needAppID:1,needCheckErrCode:-1,forceLogin:-1,body:JSON.stringify({appid:d.getProjectAppID(),jsapi:a})}),m=l.baseresponse||{errcode:-1e4},n=parseInt(m.errcode);if(n==i.AUTH_DENY)return v.UserCancel;if(0!=n){const a=j.parseCgiErrorCode(n,m.errmsg);throw a}const o=l.state||4;if(1==o)return v.Allow;if(4==o){const i=l.auth_desc||`${d.getShowName()} ${b.config.ALLOW_OBTAIN_OPERATION_PERMISSION.format(a)}`;let j='';if('getLocation'===a&&(j=w(a,e,k),!j))return v.NoAllow;const m=l.scope;return new Promise((a)=>{e({type:c.SIMULATOR_SET_CONFIRM,data:{show:!0,title:i,content:j,callback:(b)=>{const c=[];b?(c.push({state:1,scope:m}),a(v.Allow)):(c.push({state:2,scope:m}),a(v.UserCancel)),f({url:`${g.setAuth}`,method:'post',body:JSON.stringify({appid:d.getProjectAppID(),auth_item:c}),needToken:1,needAppID:1}).catch((a)=>{h.error(`checkPermission setAuth error ${a}`)})}}})})}}}return v.Allow}const b=require('./common/locales/index.js'),c=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),d=require('./3bfffbe88b3d923921f851c0697974fe.js'),e=require('./0db350fb89acd99bf2de39677770889c.js'),f=require('./15ba1827c7f6564a45df6bd44da3a977.js'),g=require('./f171257bbcaef547a3cf27266ccb0db2.js'),h=require('./72653d4b93cdd7443296229431a7aa9a.js'),i=require('./df6d0ff021a69fb541c733de4dbba0fe.js'),j=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),{isHijackEnabled:k,getHijack:l,SDK_TYPE:m}=require('./9340ce4c919f13f0d7779c9c635be1ef.js'),{invokeHooks:n,HOOK_TYPE:o}=require('./4670a8a5ef34810c4c4b823e11ef941c.js'),{APPSERVICE_SDK:p}=m,{PRE_HOOK:q,POST_HOOK:r}=o,s=(a)=>k(p)&&l(p,a),t=(a,b)=>n(p,q,{api:a,data:b}),u=(a,b,c)=>n(p,r,{api:a,data:b,result:c}),v={NoAllow:0,Allow:1,UserCancel:2,AuthFail:3},w=(a,d,e)=>{const f=e(),g=f.simulator.appConfig||{},h=g&&g.permission&&g.permission['scope.userLocation']&&g.permission['scope.userLocation'].desc||'';return h||d({type:c.SIMULATOR_SET_CONFIRM,data:{show:!0,content:b.config.NEED_PERMISSION_STATEMENT.format(a),showCancel:!0,confirmText:b.config.VIEW_DETAILS,callback:(a)=>{a&&!global.autoTest&&nw.Shell.openExternal('https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#permission')}}}),h};module.exports={exec:function(c){const{api:d}=c;return async(f,g)=>{try{const h=await a(d,f,g);let i;if(h==v.Allow){if(e[d]){t(d,c);const a=s(d);i=a?await a(e[d],f,c,g):await e[d](f,c,g),u(d,c,i)}else throw new Error(b.config.API_NOT_SUPPORT);}else if(h==v.NoAllow)throw new Error('no permission');else if(h==v.UserCancel)throw new Error('auth deny');return i}catch(a){const b={errMsg:`${d}:fail ${a.message||a}`};return u(d,c,b),b}}}}}(require('lazyload'),require);