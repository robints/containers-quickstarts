'use strict';!function(require,directRequire){const a=require('path'),b=require('react'),c=require('./a8c87029da0fa06e986298d447ab0fe2.js'),d=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),e=require('./e298e91f85bae5b5a2b792e6e73a55e3.js'),f=require('./875171e7b864aa58d026d4fa0999fbd1.js'),g=require('./d3b08a7827215cf0e9a08cbd0f38be38.js'),{connect:h}=require('react-redux'),i=require('./3c55dff3626a3ee184d599f076158345.js'),j=require('classnames'),k=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js');class l extends b.Component{constructor(a){super(a),this.state={syncCheck:!1,cloudfunctionRoot:a.cloudfunctionRoot,show:a.show,selectRootShow:!1,selectRootPopUpStyle:{},evnListShow:!1,envSelectIndex:-1}}componentDidMount(){this.props.getEnvList()}componentWillReceiveProps(a){let b={};a.show!=this.props.show&&(b.show=a.show),a.cloudfunctionRoot!=this.props.cloudfunctionRoot&&(b.cloudfunctionRoot=a.cloudfunctionRoot),0<Object.keys(b).length&&this.setState(b)}onAnimationOut(){this.state.show||this.props.setCloud({cloudfunctionRoot:{show:!1}})}onSelectClick(a){a.stopPropagation();let b=a.currentTarget.getBoundingClientRect();this.showSelectRootPopUp(b)}showSelectRootPopUp(a){this.setState({selectRootShow:!0,selectRootPopUpStyle:{left:a.left,top:a.top+a.height,width:a.width}})}onSelectRootPopUpHide(a){this.setState({selectRootShow:!1,cloudfunctionRoot:a})}onCancel(){this.setState({show:!1})}onConfirm(){if(!this.state.cloudfunctionRoot){let a=this.refs.rootSelectInput.getBoundingClientRect();return void this.showSelectRootPopUp(a)}this.props.selectEnv(this.state.envSelectIndex),this.props.setTcbFnRoot(`./${this.state.cloudfunctionRoot}`);const a=this.props.envList[this.state.envSelectIndex];this.state.syncCheck&&a.namespace&&this.props.tcbActions.downloadAllTcbFunc(),this.setState({show:!1})}onSyncCheckClick(){this.setState({syncCheck:!this.state.syncCheck})}onSelectEnvClick(a){a.stopPropagation();let b=a.currentTarget.getBoundingClientRect();this.setState({evnListShow:!0,envListLeft:b.left,envListTop:b.top})}onSelectEnv(a){this.setState({evnListShow:!1,envSelectIndex:a})}onContainerClick(){this.setState({evnListShow:!1,selectRootShow:!1})}render(){const a=this.props,c=this.props.envList.map((a)=>{return a.alias}),d=this.props.envList[this.state.envSelectIndex]||this.props.currentEnv;return b.createElement(f,{show:this.state.show,style:{width:600,marginLeft:-300},inClassName:'ui-animate-pull-down ui-dialog',outClassName:'ui-animate-pull-up ui-dialog',onAnimationOut:this.onAnimationOut.bind(this)},this.state.selectRootShow?b.createElement(g,{style:this.state.selectRootPopUpStyle,hide:this.onSelectRootPopUpHide.bind(this)}):null,b.createElement(i,{id:'toolbar-cleancache-popup',show:this.state.evnListShow,left:this.state.envListLeft,top:this.state.envListTop,list:c,onSelectClick:this.onSelectEnv.bind(this)}),b.createElement('div',{onClick:this.onContainerClick.bind(this)},b.createElement('div',{className:'ui-dialog-bd'},b.createElement('div',{className:'ui-form'},b.createElement('div',{className:'ui-form-item ui-form-item-inline'},b.createElement('label',{className:'ui-form-label',style:{width:'7em',textAlign:'right'}},'\u4E91\u51FD\u6570\u6839\u76EE\u5F55'),b.createElement('div',{className:'ui-form-controls'},b.createElement('div',{className:'ui-selector ui-selector-default',onClick:this.onSelectClick.bind(this),ref:'rootSelectInput'},b.createElement('input',{className:'ui-selector-input',placeholder:'\u8BF7\u9009\u62E9',value:this.state.cloudfunctionRoot,readOnly:!0}),b.createElement('div',{className:'ui-selector-dropdown'},b.createElement('i',{className:'ui-icon-arrow-down-o'}))),b.createElement('p',{className:'ui-form-tips'},'\u6307\u5B9A\u6839\u76EE\u5F55\u4E0B\u7684\u76EE\u5F55\u4F5C\u4E3A\u4E91\u51FD\u6570\u76EE\u5F55, ',b.createElement('a',{href:'javascript:;'},'\u4E86\u89E3\u66F4\u591A')))),b.createElement('div',{className:'ui-form-item ui-form-item-inline',style:{display:0<this.props.envList.length&&!this.props.isSetting?'':'none'}},b.createElement('label',{className:'ui-form-label',style:{width:'7em',textAlign:'right'}}),b.createElement('div',{className:'ui-form-controls'},b.createElement('div',{className:'ui-flex',onClick:this.onSyncCheckClick.bind(this)},b.createElement('label',{className:'ui-checkbox'},b.createElement('i',{className:j({"ui-icon-checkbox":!this.state.syncCheck,"ui-icon-checkbox-o":this.state.syncCheck})}),b.createElement('span',{className:'ui-checkbox-text'},' \u4ECE\u7EBF\u4E0A\u73AF\u5883\u4E0B\u8F7D\u5E76\u8986\u76D6\u4E91\u51FD\u6570\u81F3\u672C\u5730\u73AF\u5883 '))))),b.createElement('div',{className:'ui-form-item ui-form-item-inline',style:{display:this.state.syncCheck||this.props.isSetting?'':'none'}},b.createElement('label',{className:'ui-form-label',style:{width:'7em',textAlign:'right'}},'\u9009\u62E9\u73AF\u5883'),b.createElement('div',{className:'ui-form-controls'},b.createElement('div',{className:'ui-selector ui-selector-default',onClick:this.onSelectEnvClick.bind(this)},b.createElement('input',{className:'ui-selector-input',placeholder:'\u8BF7\u9009\u62E9',value:d&&d.alias,readOnly:!0}),b.createElement('div',{className:'ui-selector-dropdown'},b.createElement('i',{className:'ui-icon-arrow-down-o'}))),b.createElement('p',{className:'ui-form-tips'},'\u5C06\u4ECE\u8BE5\u7EBF\u4E0A\u73AF\u5883\u4E0B\u8F7D\u5E76\u8986\u76D6\u4E91\u51FD\u6570\u81F3\u672C\u5730\u73AF\u5883'))))),b.createElement('div',{className:'ui-dialog-ft'},b.createElement('div',{className:'ui-dialog-action'},b.createElement('button',{className:'ui-button ui-button-default',onClick:this.onCancel.bind(this)},'\u53D6\u6D88'),b.createElement('button',{className:'ui-button ui-button-primary',onClick:this.onConfirm.bind(this)},'\u786E\u5B9A')))))}}module.exports=h((b)=>{const c=b.project.current||{},d=c.tcb||{};let e=c.cloudfunctionRoot||'';return{cloudfunctionRoot:a.posix.normalize(e),show:b.window.cloud&&b.window.cloud.cloudfunctionRoot&&b.window.cloud.cloudfunctionRoot.show,currentEnv:d.currentEnv,envList:d.envList||[]}},(a)=>{return{setCloud:(b)=>{a(c.setCloud(b))},setTcbFnRoot:(b)=>{a(d.setTcbFnRoot(b))},getEnvList:(b)=>{e.getEnvList(b)(a)},selectEnv:(b)=>{a(e.selectEnv(b))},tcbActions:k.bindActionCreators(e,a)}})(l)}(require('lazyload'),require);