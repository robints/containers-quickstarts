'use strict';!function(require,directRequire){const a=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),b=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),c=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),d=require('./6ff091369f442a4678a2ed4a1f758495.js'),e=require('./78294f0b5b50fc38258d7028553744ef.js'),f=require('./36244f5aa8a25574083d64e28953b466.js'),g=require('./5eb00762b104199e0cf0af7efbe591da.js'),h=require('./5719b6ded53098ffd9e848abcac30153.js'),i=require('./da7c31daaf542cf1796023d8e344b98a.js'),j=require('./bc2b895ee57942c71d19191b1e204b79.js'),k='darwin'===process.platform,l=(a,b)=>new Promise(async(c,d)=>{try{let f;if(f=e.checkProjectPath(a),f.error)return d(f.error);let g;if(f=e.checkProjectConfigJSON(a),f.error)return d(f.error);if(g=f.config,!g.appid||!g.projectname)return d(h.ERROR.NOT_FOUND_IN_PROJECT_CONFIG_JSON(g.appid?'projectname':'appid'));let i=a;i.endsWith('/')||(i+='/');let k='';switch(b||g.compileType){case'plugin':k=i+(g.pluginRoot||'');break;case'weapp':default:k=i+(g.miniprogramRoot||'');}const l=Date.now();let m,n=!1;try{m=await j(k,{appid:g.appid})}catch(a){return console.error(a),n=!0,d(h.ERROR.GENERIC_ERROR((a&&a.toString()||a)+(a.stack||'')))}n||(m?c(JSON.stringify({cost:Date.now()-l,warnings:(m||[]).map((a)=>{const b='number'==typeof a.startLine?`${a.jsPath}:${a.startLine}-${a.endLine}`:a.jsPath;return`${b}: ${a.msg}`})})):d(h.ERROR.NOT_FOUND_NODE_MODULES()))}catch(a){d(h.ERROR.GENERIC_ERROR(a.toString()))}});module.exports={registerHandlers:(a)=>{a.get('/buildnpm',async(a,b)=>{try{const c=decodeURIComponent(a.mQuery.projectpath||''),d=decodeURIComponent(a.mQuery.compiletype||''),e=decodeURIComponent(a.mQuery.cli||''),f=decodeURIComponent(a.mQuery.from||'');e?f?i('cli_build_npm',null,null,{engine_from:f}):i('cli_build_npm'):f?i('http_build_npm',null,null,{engine_from:f}):i('http_build_npm');const g=await l(c,d);b.writeHead(200,{"Content-Type":'application/json; charset=utf-8'}),b.end(g,'utf8')}catch(a){b.statusCode=400;try{JSON.parse(a)&&b.writeHead(400,{"Content-Type":'application/json; charset=utf-8'})}catch(a){}b.end(a.toString(),'utf8')}})}}}(require('lazyload'),require);