;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),buttons_template_1=require('./70573f37125865bbce47ab60c6150475.js'),store=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),windowActions=require('./a8c87029da0fa06e986298d447ab0fe2.js');class ProgressRecorder extends events_1.EventEmitter{constructor(){super(...arguments),this.tasks=new Map}add(a){const b=Object.assign({},a,{status:a.status||ITaskStatus.pending,startTime:a.startTime||+new Date,progressIndeterminate:a.hasOwnProperty("progressIndeterminate")?a.progressIndeterminate:!!a.hasOwnProperty("progress"),showInDialog:!0});b.progressIndeterminate&&(b.progress=0),this.tasks.set(b.id,b),this.emit(ITaskEvent.add,b),this.emit(ITaskEvent.change),b.progressIndeterminate&&this.fakeProgress(b.id)}updateProgress(a,b){const c=this.tasks.get(a);c&&(0>b?b=0:100<b&&(b=100),c.progress=b,this.emit(ITaskEvent.update,c),this.emit(ITaskEvent.change))}updateDetails(a,b){const c=this.tasks.get(a);c&&(c.details=b,this.emit(ITaskEvent.update,c),this.emit(ITaskEvent.change))}deleteProgress(a){const b=this.tasks.get(a);b&&(this.emit(ITaskEvent.delete,b),this.tasks.delete(a),this.emit(ITaskEvent.change))}markSuccess(a,b){this.markEnd(a,ITaskStatus.success,b)}markFail(a,b){this.markEnd(a,ITaskStatus.fail,b)}markEnd(a,b,c={}){const d=this.tasks.get(a);if(d){const{buttonsTemplate:a,buttons:e,showNotice:f=!0}=c,g=!e&&a?buttons_template_1.getTemplate(a,d):e||{};if(b!==ITaskStatus.success&&b!==ITaskStatus.fail)throw new Error("unknown status, cannot mark task end");if(d.endTime=+new Date,d.status=b,b===ITaskStatus.success?(d.progress=100,this.emit(ITaskEvent.success,d,g)):b===ITaskStatus.fail&&this.emit(ITaskEvent.fail,d,g),this.emit(ITaskEvent.end,d,g),f){let a=d.name;d.successName&&b===ITaskStatus.success&&(a=d.successName),d.failName&&b===ITaskStatus.fail&&(a=d.failName),store.dispatch(windowActions.addNotices([{id:d.id,name:a,time:d.endTime,details:d.details&&d.details.split("\n"),icon:b===ITaskStatus.success?"success":"fail",type:"task",customType:d.type,combinable:b===ITaskStatus.success,buttons:g}]))}this.emit(ITaskEvent.change)}}hideInDialog(a){const b=this.tasks.get(a);b&&(b.showInDialog=!1,this.emit(ITaskEvent.update,b),this.emit(ITaskEvent.change))}fakeProgress(a){const b=setInterval(()=>{const c=this.tasks.get(a);if(!c)return clearInterval(b);const d=(c.progress||0)+1;return 100<=d||c.status!==ITaskStatus.pending?(c.status===ITaskStatus.success&&100!==c.progress&&this.updateProgress(a,100),clearInterval(b)):void this.updateProgress(a,d)},1e3)}}let progressRecorder;exports.get=()=>{return progressRecorder||(progressRecorder=new ProgressRecorder),progressRecorder};var ITaskStatus;(function(a){a.pending="pending",a.success="success",a.fail="fail"})(ITaskStatus=exports.ITaskStatus||(exports.ITaskStatus={}));var ITaskEvent;(function(a){a.add="add",a.success="success",a.fail="fail",a.end="end",a["delete"]="delete",a.update="update",a.change="change"})(ITaskEvent=exports.ITaskEvent||(exports.ITaskEvent={}));var buttons_template_2=require('./70573f37125865bbce47ab60c6150475.js');exports.TEMPLATE=buttons_template_2.TEMPLATE;
;}(require("lazyload"), require);
