;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path=require("path"),babelCodeFrame=require("babel-code-frame"),babel=require("babel-core"),vendorManager=require('./d28a711224425b00101635efe1034c99.js'),contentWatcher=require('./162bf2ee28b76d3b3d95b685cede4146.js'),compileCache=require('./2e9637e8a0816a626f7db9a0dee5efe8.js'),checkGameJSON=require('./48679210e49dc5028a8b6642263eba75.js'),runTask=require('./41168dca39589e852da6631126d0f94d.js'),errorPrefix=require('./6242f55dbdfe53c2f07b7a51568311f2.js').errorPrefix,consoleDisplay=require('./2dfc6a3df6d6fc51266b293c8420e88b.js'),C=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),store=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),fileRules=require('./1c8a8c710417d102ab574145dc51b4b0.js'),tools=require('./84b183688a46c9e2626d3e6f83365e13.js'),{asDebug,subAsDebug,workerAsDebug,WeixinWorkerTpl}=require('./d9ce5316cc172b6017fdd2399a91117a.js');let cpus,largeFilesTimeout,largeFiles=[];function pushLargeFiles(a){largeFiles.push(a),largeFilesTimeout&&clearTimeout(largeFilesTimeout),largeFilesTimeout=setTimeout(()=>{largeFilesTimeout=void 0,consoleDisplay.display({command:C.DISPLAY_INFO,type:"COMPILE_JS_TOO_LARGE_IGNORE",data:{files:[...largeFiles]}}),largeFiles=[]},1e3)}async function compileJS(a,b,c){const{setting:d}=a;await compileCache.init(a);let e=b.getFile(c,"utf8");const f=tools.generateMD5(e),g=compileCache.CACHE_KEYS.JS_FILE,h=path.posix.join(b.srcPath,c),i=compileCache.get(g,h);if(i&&i.code&&i.es6===d.es6&&i.md5===f)return i.code;const j=(a.debugOptions||{}).hidedInDevtools||[],k=await checkGameJSON(a),l=k.workers,m=l&&0===c.indexOf(l);if(d.es6){const a=path.basename(c);if(512000>e.length){let d=!0;try{d=!store.getState().settings.compiler.clusterCompile,"number"!=typeof cpus&&(cpus=require("os").cpus().length),d=d||4>=cpus}catch(a){console.error(a),d=!0}try{const f=await runTask({taskName:"processJS",config:{projectPath:b.srcPath,file:c,es6:"yes",sourceMaps:"map",sourceFileName:a},dataStr:e,useBackup:!0,maxTimeout:60000,forceBackup:d,showInStatus:{text:`compiling ${c}`}});if(f.error)throw f.error;fileRules.isFileHidedInDevtools(c,j)&&delete f.map,e=f.map?`${f.code}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,${new Buffer(f.map).toString("base64")}`:f.code}catch(a){let b=a;throw b instanceof Error||(b=new Error(a.message),b.message=a.message),consoleDisplay.display({command:C.DISPLAY_ERROR,type:errorPrefix.CODE_ERROR,data:{error:b}}),b}}else pushLargeFiles(c)}return e=`define("${c.replace(/\"/g,"\\\"")}", function(require, module, exports, process){ ${e}\n});`,m&&(e=`__workersCode__['${c}'] = ${JSON.stringify(e)}`),compileCache.set(g,h,{code:e,md5:f,es6:d.es6}),e}async function getFile(a,b,c){if(0===b.indexOf("__dev__/")){const a=b.replace("__dev__/",""),c=await vendorManager.getFile(a);return c}if(0===b.indexOf("__subdev__/")){const a=b.replace("__subdev__/",""),c=await vendorManager.getFile(a);return c}if(0===b.indexOf("__workerdev__/")){const a=b.replace("__workerdev__/",""),c=await vendorManager.getFile(a);return`__workerVendorCode__['${a}'] = ${JSON.stringify(c.toString("utf8"))}`}if(0===b.indexOf("__alphadev__/")){const a=b.match(/__alphadev__\/([-_\w\.]*)$/);return a&&a[1]?await vendorManager.getAlphaFile(a[1]):""}if(0===b.indexOf("__asdebug__/"))return asDebug;if(0===b.indexOf("__subasdebug__/"))return subAsDebug;if(0===b.indexOf("__workerasdebug__")){if(b.endsWith("workerasdebug.js"))return workerAsDebug;if(b.endsWith("weixinworker.js"))return WeixinWorkerTpl}const d=await contentWatcher(a),e=path.extname(b);return".js"===e?await compileJS(a,d,b):d.getFile(b,c)}module.exports=getFile;
;}(require("lazyload"), require);
