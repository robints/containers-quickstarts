;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs"),path=require("path"),crypto=require("crypto"),ls=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),dirConfig=require('./92320c1386e6db6a6f2556736a9bc280.js'),isMac="darwin"===process.platform,child_process=require("child_process"),portfinder=require('./8baad0631295efb1130774c37d944951.js');async function getAvailablePort(){return portfinder.findFreePort("127.0.0.1")}exports.getAvailablePort=getAvailablePort;function getType(a){return Object.prototype.toString.call(a).toLowerCase().split(" ")[1].replace("]","")}exports.getType=getType;function getVersionNum(a){return a=a||global.appVersion,a+="",a=a.replace(/\./g,""),parseInt(a,10)}exports.getVersionNum=getVersionNum;function compareSemVer(a,b){if(!a&&!b)return 0;if(!a)return-1;if(!b)return 1;const c=/\d+/g,d=a.match(c),e=b.match(c);if(!d)return 1;if(!e)return-1;const f=d.map((a)=>parseInt(a,10)),g=e.map((a)=>parseInt(a,10)),h=d.length>e.length?e.length:d.length;for(let c=0;c<h;c++){if(f[c]<g[c])return-1;if(f[c]>g[c])return 1}return f.length===g.length?0:f.length<g.length?-1:1}exports.compareSemVer=compareSemVer;async function checkUpdateApp(){return new Promise((a,b)=>{const c=global.appVersion,d=dirConfig.WeappApplication;if(ls.forceUpdateVersion){const e=ls.forceUpdateVersion;ls.removeForceUpdateVersion();const f=getVersionNum(e),g=getVersionNum(c);let h="";if(g<f)h=`当前${c}版本太旧，请正在新版本${e}...`;else if(g>f)h=`当前版本${c}存在问题, 回退至版本${e}...`;else return a();const i=isMac?"darwin":"x64"===process.arch?"x64":"ia32",j=`${i}_${e.replace(/\./g,"")}.${isMac?"dmg":"exe"}`,k=path.join(d,j);if(fs.existsSync(k)){const a=global.contentDocument.querySelector("#container");a.innerHTML=`<div class="app-up-data" style="text-align:center;margin-top: 50%; font-size: 16px;padding:20px;">${h}</div>`;const c=isMac?"open":j,e=isMac?[j]:[];try{const b=child_process.spawn(c,e,{detached:!0,cwd:d});b.on("close",(b)=>{0!==b&&(a.innerHTML="<div class=\"app-up-data\" style=\"text-align:center;margin-top: 50%;font-size: 16px; padding:20px;\">\u66F4\u65B0\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u542F\u52A8</div>"),setTimeout(()=>{quit()},2e3)})}catch(a){setTimeout(()=>{nw.Shell.openItem(path.join(d,j)),setTimeout(()=>{quit()},2e3)},200)}return b()}}a()})}exports.checkUpdateApp=checkUpdateApp;function getAppConfig(){return{isDev:!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app")||!!process.execPath.match("nwjs.exe"),isBeta:!0===nw.App.manifest.beta,isGamma:!0===nw.App.manifest.gamma}}exports.getAppConfig=getAppConfig;function openInspectWin(){nw.Window.open("about:blank",{show:!1,width:799,height:799},(a)=>{a.maximize(),a.window.location="chrome://inspect/#devices",a.show()})}exports.openInspectWin=openInspectWin;function fixPreferencesFile(){const a=nw.App.getDataPath(),b=path.join(a,"Secure Preferences"),c=fs.readFileSync(b,"utf8"),d=JSON.parse(c),{extensions:e}=d,{settings:f}=e,g=chrome.runtime.id,h=f[g];h.events=[],h.filtered_events={},fs.writeFileSync(b+"_temp",JSON.stringify(d));const i=require('./d28a711224425b00101635efe1034c99.js'),j=path.join(dirConfig.WeappLog,`fixpreferences.log`);fs.writeFileSync(b,JSON.stringify(d));const k=child_process.spawn(i.getFixpreferencesPath(),[b,`${b}_temp`,j,300],{stdio:"ignore",detached:!0});k.unref()}exports.fixPreferencesFile=fixPreferencesFile;function quit(){isMac&&fixPreferencesFile(),nw.App.quit()}exports.quit=quit;function rmSync(a){try{if(a=path.resolve(a),!fs.existsSync(a))return;const b=fs.statSync(a);if(b.isDirectory()){const b=fs.readdirSync(a);if(0<b.length)for(let c=0,d=b.length;c<d;c++)rmSync(path.join(a,b[c]));fs.rmdirSync(a)}else fs.unlinkSync(a)}catch(a){}}exports.rmSync=rmSync;function mvSync(a,b){try{if(a=path.resolve(a),b=path.resolve(b),!fs.existsSync(a))return;if(fs.existsSync(b)){const c=fs.statSync(b),d=fs.statSync(a);if(d.isDirectory()&&c.isDirectory()){const c=fs.readdirSync(a);for(let d=0,e=c.length;d<e;d++)mvSync(path.join(a,c[d]),path.join(b,c[d]));return void fs.rmdirSync(a)}c.isDirectory()&&rmSync(b)}fs.renameSync(a,b)}catch(a){}}exports.mvSync=mvSync;function mkdirSync(a){if(a=path.resolve(a),fs.existsSync(a)){const b=fs.statSync(a);if(b.isDirectory())return;fs.unlinkSync(a)}mkdirSync(path.dirname(a)),fs.mkdirSync(a)}exports.mkdirSync=mkdirSync,exports.normalizeFileMode=(a)=>{let b;return b="number"==typeof a?a.toString(8):a,b.substring(b.length-3)};function cpSync(a,b){if(a=path.resolve(a),b=path.resolve(b),!!fs.existsSync(a)){const c=fs.lstatSync(a);if(c.isDirectory()){mkdirSync(b);const c=fs.readdirSync(a);for(let d=0,e=c.length;d<e;d++)cpSync(path.join(a,c[d]),path.join(b,c[d]))}else{if(fs.existsSync(b)){const a=fs.lstatSync(b);if(a.isDirectory()){const a=path.dirname(b);let c=path.join(a,""+Math.random());for(;fs.existsSync(c)||c===b;)c=path.join(a,""+Math.random());fs.renameSync(b,c)}}mkdirSync(path.dirname(b)),fs.writeFileSync(b,fs.readFileSync(a),{mode:exports.normalizeFileMode(c.mode)})}}}exports.cpSync=cpSync;function getQuery(a=""){a=a.replace(/^\?/,"");const b=a.split("&"),c={};for(let d=0,e=b.length;d<e;d++){const a=(b[d]||"").split("=");c[a[0]]="projectid"===a[0]?a[1]:decodeURIComponent(a[1])}return c}exports.getQuery=getQuery;function normalizePath(a=""){const b=path.posix.normalize(a.replace(/\\/g,"/"));return(a.startsWith("//")||a.startsWith("\\\\"))&&!b.startsWith("//")?"/"+b:b}exports.normalizePath=normalizePath;function generateMD5(a){const b=crypto.createHash("md5");return b.update(a),b.digest("hex")}exports.generateMD5=generateMD5;async function chooseFile(a){const b=global.windowMap.get("MAIN").window,c=document.createElement("input");return c.style.display="none",c.setAttribute("type","file"),a.accept&&c.setAttribute("accept",a.accept),a.multiple&&c.setAttribute("multiple","multiple"),b.document.body.appendChild(c),c.click(),new Promise((a)=>{c.addEventListener("change",(d)=>{b.document.body.removeChild(c),a({success:!0,event:d})}),c.addEventListener("cancel",(d)=>{b.document.body.removeChild(c),a({success:!1,event:d})})})}exports.chooseFile=chooseFile;function fillArray(b,c){if(0===c)return[];let d=[b];for(;2*d.length<=c;)d=d.concat(d);return d.length<c&&(d=d.concat(d.slice(0,c-d.length))),d}exports.fillArray=fillArray;function random(){return generateMD5(Math.random()+""+Date.now())}exports.random=random;function escapeScript(a){return a?a.replace(/<script/g,"&lt;script").replace(/<\/script/g,"&lt;/script"):a}exports.escapeScript=escapeScript;function escapeQuot(a,b="`"){return a?"`"===b?a.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$/g,"\\$"):"\""===b?a.replace(/\\/g,"\\\\").replace(/\r\n/g,"\n").replace(/\n/g,"\\n").replace(/"/g,"\\\""):"'"===b?a.replace(/\\/g,"\\\\").replace(/\r\n/g,"\n").replace(/\n/g,"\\n").replace(/'/g,"\\'"):a:a}exports.escapeQuot=escapeQuot;function executeScript(a,b){const{code:c,webview:d}=a;if(d&&c){const a=`(function(){
    delete this.nw;
    this.chrome = null
  })();`;d._webview?d._webview.executeScript({code:a+c},b):d.executeScript({code:a+c},b)}}exports.executeScript=executeScript;function webviewScriptCreatorFactory(){let a=0;return function(b){a++;const{data:c,type:d,autoRemove:e}=b,f=escapeQuot(c,"`");let g="";return"text"===d?(g=`scriptNode.text = \`${f}`,g+=e?`;
        const node = global.__global.document.getElementById('\${fnName}');
        node.parentElement.removeChild(node)
        \``:"`;"):"link"===d&&(g=`scriptNode.src = \`${f}\`;`,e&&(g+=`scriptNode.onload = function() {
          const node = document.getElementById(fnName);
          node.parentElement.removeChild(node)
        }`)),`
      ;(function(global){
        const container = document.getElementsByTagName("head")[0]
        const scriptNode = document.createElement('script')
        scriptNode.type = "text/javascript";
        const fnName = "script${a}"
        scriptNode.id = fnName
        ${g}
        container.appendChild(scriptNode)
      })(this);
    `}}exports.webviewScriptCreatorFactory=webviewScriptCreatorFactory;function shouldUseConfigFile(a){if("darwin"!==process.platform){if(128<a.length)return!0;for(const b of a)if(1e4<b.length)return!0}return!1}exports.shouldUseConfigFile=shouldUseConfigFile;const SIZE_MAGNITUDE={B:1,KB:1024,MB:1048576};function getFormattedSize(a,b="B",c="AUTO"){if("AUTO"!==c){const d=a/(SIZE_MAGNITUDE[c]/SIZE_MAGNITUDE[b]);return 0===+d.toFixed(1)?`${d.toPrecision(1)} ${c}`:`${d.toFixed(1)} ${c}`}const d=a*SIZE_MAGNITUDE[b];return d>SIZE_MAGNITUDE.MB?`${(d/SIZE_MAGNITUDE.MB).toFixed(1)} MB`:d>SIZE_MAGNITUDE.KB?`${(d/SIZE_MAGNITUDE.KB).toFixed(1)} KB`:`${d.toFixed(1)} B`}exports.getFormattedSize=getFormattedSize,exports.webviewScriptCreator=webviewScriptCreatorFactory();
;}(require("lazyload"), require);
