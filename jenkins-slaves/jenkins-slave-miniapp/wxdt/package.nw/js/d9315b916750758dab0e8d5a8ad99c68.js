;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),React=require("react"),react_1=require("react"),locales=require('./common/locales/index.js'),card_1=require('./9344c573c2fc82f84fc4e1bfa5b763a8.js'),create_project_container_1=require('./bdbf06bc9f97badd3ab5ba497b62543a.js'),C=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),defaultsConfig=require('./5498e660c05c574f739a28bd5d202cfa.js'),TAB=C.SELECT_PROJECT_TAB;var ProjectType;(function(a){a.MiniProgram="miniprogram",a.MiniGame="minigame",a.MiniCode="minicode"})(ProjectType=exports.ProjectType||(exports.ProjectType={}));var Mode;(function(a){a.Select="select",a.Manage="manage",a.Create="create",a.Import="import"})(Mode=exports.Mode||(exports.Mode={}));let SelectProject=class extends react_1.Component{constructor(a){super(a),this.localesMap={[ProjectType.MiniProgram]:{get title(){return locales.config.MINI_PROGRAM},get desc(){return locales.config.MINI_PROGRAM_PROJECT_DEBUG}},[ProjectType.MiniGame]:{get title(){return locales.config.MINI_GAME},get desc(){return locales.config.MINI_GAME_PROJECT_DEBUG}},[ProjectType.MiniCode]:{get title(){return locales.config.MINI_CODE},get desc(){return locales.config.MINI_CODE_DETAIL}}},this.manageProjects=()=>{this.setState({projectSelected:""}),this.props.setEntrance({[this.props.entrance.tab]:{mode:Mode.Manage}}),report("weapp_manager")},this.manageProjectsDone=()=>{this.props.setEntrance({[this.props.entrance.tab]:{mode:Mode.Select}}),this.setState({checkboxStatus:{}})},this.onCheckboxClick=(a,b)=>{const c=Object.assign({},this.state.checkboxStatus);b?delete c[a]:c[a]=!0,this.setState({checkboxStatus:c})},this.onSelectAllClick=()=>{const a=Object.keys(this.props.projects).filter(this.filterProjects);if(a.length===Object.keys(this.state.checkboxStatus).length)this.setState({checkboxStatus:{}});else{const b={};for(const c of a)b[c]=!0;this.setState({checkboxStatus:b})}},this.deleteProjectsSelected=async()=>{const a=Object.keys(this.state.checkboxStatus);if(a&&0!==a.length){const b=a.map((a)=>this.props.projects[a]).filter((a)=>a),c=b.map((a)=>a.projectname).join(`${locales.config.COMMA} `),d=await this.props.confirm({id:"PM-MULTI-DEL",title:locales.config.PROJECT_DELETE_TITLE.format(c),content:locales.config.PROJECT_DELETE_CONTENT});if(d)for(const a of b)try{this.props.removeProject(a.projectid);const c=Object.assign({},this.state.checkboxStatus);for(const a of b)delete c[a.projectid];this.setState({checkboxStatus:c}),this.props.setEntrance({[this.props.entrance.tab]:{mode:Mode.Select}})}catch(a){}report("weapp_manager_multi_del")}},this.focusProject=(a)=>{const b=this.props.entrance[this.props.entrance.tab].mode;if(b===Mode.Select)this.setState({projectSelected:this.state.projectSelected===a?"":a});else if(b===Mode.Manage){const b=Object.assign({},this.state.checkboxStatus);b[a]?delete b[a]:b[a]=!0,this.setState({checkboxStatus:b})}},this.openProject=(a)=>{this.setState({projectSelected:a}),this.props.openProject(a)},this.openProjectSelected=()=>{this.state.projectSelected&&this.props.openProject(this.state.projectSelected)},this.createProject=()=>{this.props.setEntrance({[this.props.entrance.tab]:{mode:Mode.Create}})},this.compareProjects=(c,a)=>{try{return(this.props.projects[a].accessTime||1)-(this.props.projects[c].accessTime||1)}catch(a){return-1}},this.filterProjects=(a)=>{const b=this.props.projects[a];return!!b&&(this.props.type===ProjectType.MiniGame?!b.isMiniCode&&"game"===b.compileType:this.props.type===ProjectType.MiniCode?!!b.isMiniCode:!b.isMiniCode&&"game"!==b.compileType)},this.handleMaskClick=()=>{this.setState({showMask:!1})},this.state={showMask:!1,projectSelected:"",checkboxStatus:{}}}handleQuitClick(){tools.quit()}jumpMiniCodeDoc(){nw.Shell.openExternal("https://developers.weixin.qq.com/miniprogram/dev/devtools/minicode.html")}renderSelectProject(){const a=this.props.entrance[this.props.entrance.tab],b=this.props.entrance[this.props.entrance.tab].mode,c=Object.keys(this.props.projects).filter(this.filterProjects).sort(this.compareProjects).map((c)=>{const d=this.props.projects[c];if(this.props.type===ProjectType.MiniCode){const e=d.attr&&d.attr.appImageUrl||defaultsConfig.default_weapp_header;return React.createElement(card_1.Card,{key:c,id:c,cardStyle:card_1.CardStyle.Snippet,title:decodeURIComponent(d.projectname),tips:d.projectpath,icon:e,active:this.state.projectSelected===c||b===Mode.Manage&&this.state.checkboxStatus[c],hasCheckbox:a.mode===Mode.Manage,checkboxChecked:this.state.checkboxStatus[c],onCardClick:this.focusProject,onCardDoubleClick:this.openProject,onCheckboxClick:this.onCheckboxClick})}const e=d.attr&&d.attr.appImageUrl||defaultsConfig.default_weapp_header;return React.createElement(card_1.Card,{key:c,id:c,cardStyle:card_1.CardStyle.Project,title:decodeURIComponent(d.projectname),tips:d.projectpath,icon:e,active:this.state.projectSelected===c||b===Mode.Manage&&this.state.checkboxStatus[c],coverImg:this.props.covers[c],hasCheckbox:a.mode===Mode.Manage,checkboxChecked:this.state.checkboxStatus[c],onCardClick:this.focusProject,onCardDoubleClick:this.openProject,onCheckboxClick:this.onCheckboxClick})}),d=this.props.type===ProjectType.MiniCode?React.createElement("div",{className:"snippet-card",onClick:this.createProject},React.createElement("div",{className:"snippet-card-create"},React.createElement("i",{className:"snippet-card-create-icon"}))):React.createElement("div",{className:"project-card",onClick:this.createProject},React.createElement("div",{className:"project-create"},React.createElement("i",{className:"project-create-icon"})));let e;this.props.type===ProjectType.MiniCode&&(e=React.createElement("a",{href:"javascript:;",onClick:this.jumpMiniCodeDoc},locales.config.LEARN_MORE));let f="ui-icon-square";c.length===Object.keys(this.state.checkboxStatus).length&&(f="ui-icon-square-h");const g={display:"none"},h={},i={WebkitAppRegion:"no-drag"};return[React.createElement("div",{className:"dashboard-content",key:"content",style:this.props.entrance.tab===this.props.type?h:g},React.createElement("div",{className:"dashboard-type"},React.createElement("h2",{className:"dashboard-title"},this.localesMap[this.props.type].title),React.createElement("p",{className:"dashboard-desc",style:i},this.localesMap[this.props.type].desc," ",e)),React.createElement("div",{className:"project-cards",style:i},d,c)),React.createElement("div",{className:"dashboard-toolbar",key:"toolbar",style:this.props.entrance.tab===this.props.type?i:g},React.createElement("a",{className:"dashboard-toolbar-item",onClick:this.manageProjects},React.createElement("i",{className:"ui-icon-cogs",style:a.mode===Mode.Manage?g:h}),React.createElement("span",{style:a.mode===Mode.Manage?g:h},locales.config.MANAGE),React.createElement("label",{htmlFor:"",className:"ui-checkbox",style:a.mode===Mode.Manage?h:g,onClick:this.onSelectAllClick},React.createElement("input",{type:"checkbox",checked:!1}),React.createElement("i",{className:f}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.SELECT_ALL))),React.createElement("div",null,React.createElement("button",{className:"ui-button ui-button-default ui-button-warn",style:a.mode===Mode.Manage?h:g,disabled:0===Object.keys(this.state.checkboxStatus).length,onClick:this.deleteProjectsSelected},locales.config.DELETE),React.createElement("button",{className:"ui-button ui-button-primary",style:a.mode===Mode.Manage?h:g,onClick:this.manageProjectsDone},locales.config.DONE),React.createElement("button",{className:"ui-button ui-button-primary",style:this.state.projectSelected?h:g,onClick:this.openProjectSelected},locales.config.OPEN)))]}renderCreateProject(){return React.createElement(create_project_container_1.CreateProjectContainer,{type:this.props.type})}render(){switch(this.props.entrance[this.props.type].mode){case Mode.Create:case Mode.Import:return this.renderCreateProject();case Mode.Select:case Mode.Manage:return this.renderSelectProject();default:return this.renderSelectProject();}}};SelectProject=tslib_1.__decorate([locales.mixin],SelectProject),exports.SelectProject=SelectProject;
;}(require("lazyload"), require);
