'use strict';!function(require,directRequire){function a(a){try{a.filter_buffer&&a.filter_buffer.msg_job_id&&g({url:h.reportTipsClick,method:'post',body:JSON.stringify({job_id:a.filter_buffer.msg_job_id}),needToken:1}).then((a)=>{global.appConfig.isDev&&console.log('report tips click res',a)}).catch((a)=>{i.error(`report tips click error: ${a.toString()}`)})}catch(a){}}function b(b){try{const c=JSON.parse(b.content),d={type:j.DBType.system,title:c.title||'',content:c.content||'',timestamp:b.create_time},e={title:c.title||'',message:c.content||''};switch(c.tips_type){case j.TipsType.toast:{e.priority=1,r||(e.requireInteraction=!1);break}case j.TipsType.info:{e.priority=2,r||(e.requireInteraction=!r);break}case j.TipsType.link:{e.priority=2,r||(e.requireInteraction=!r),e.buttons=[{title:c.confirmText||q.config.VIEW_DETAILS}],e.callback=function(d){0===d&&(nw.Shell.openExternal(c.link),a(b))},d.link=c.link;break}}return l(e),d}catch(a){i.error(`handleSystemTipsMsg ${a}`)}}function c(b){const c=m.getState(),d=c.settings&&c.settings.notification||{};try{const c=JSON.parse(b.content),e={type:j.DBType.bbs,title:c.title||'',content:c.content||'',timestamp:b.create_time,filter_buffer:b.filter_buffer,from_uin:b.from_uin},f={title:c.title||'',message:c.content||'',priority:2,requireInteraction:!r};switch(c.tips_type){case j.CmdTipsType.showNewFeature:return console.group('recv deprecated msg:'),console.warn(c),void console.groupEnd();case j.CmdTipsType.visitBBS:return f.buttons=[{title:c.confirmText||q.config.VIEW_DETAILS}],f.callback=(d)=>{0==d&&(n.BBS(c.link,p.IDE_SCENE.NOTIFY),a(b))},e.link=c.link,d.bbs&&l(f,!0),e;case j.CmdTipsType.alarm:return e.type=j.DBType.alarm,e.link=c.link,f.callback=(d)=>{0==d&&(nw.Shell.openExternal(c.link),a(b))},f.buttons=[{title:c.confirmText||q.config.VIEW_DETAILS}],d.alarm&&l(f,!0),e;case j.CmdTipsType.mobileTest:return e.type=j.DBType.system,d.sys&&(f.buttons=[{title:c.confirmText||q.config.VIEW_DETAILS}],f.callback=async(a)=>{if(0==a)try{const{body:a}=await g({url:`${h.getMobileTestOpenTicket}`,needToken:1,needAppID:1});let b=-1<c.link.indexOf('?')?`${c.link}&devcode=${a.open_ticket}`:`${c.link}?devcode=${a.open_ticket}`;nw.Window.open(b,{width:p.SIZE.MOBILE_TEST_REPORT.WIDTH,height:p.SIZE.MOBILE_TEST_REPORT.HEIGHT,min_width:p.SIZE.MOBILE_TEST_REPORT.MIN_WIDTH})}catch(a){console.info(`mobile init open report error: ${a}`)}},l(f)),e;}}catch(a){i.error(`handleSystemTipsMsg ${a}`)}}async function d(a){const d=m.getState(),e=d.settings&&d.settings.notification||{},f=[];for(let d=a.length-1;0<=d;d--){const g=a[d];let h;switch(g.type){case j.MsgType.tips:{e.sys&&(h=b(g));break}case j.MsgType.cmdTips:{h=c(g);break}case j.MsgType.systemMsg:break;default:}h&&f.push(h)}0<f.length&&(await o.open(),await o.insert(f),await o.close())}function e(a){if(a&&a.data){const b=JSON.parse(a.data).list;d(b)}}async function f(){const a=k.syncKey,b=k.batchSyncKey,{body:c}=await g({url:h.syncMessage,method:'post',body:JSON.stringify({sync_key:[a,b]}),needToken:1});console.group('recv raw syncMessage resp body:'),console.warn(c),console.groupEnd();let d;try{const a=c.sync_data[0],b=c.sync_data[1];e(a),e(b),a&&(k.syncKey=a.sync_key),b&&(k.batchSyncKey=b.sync_key)}catch(a){d=`sync catch error ${a}`}d&&i.error(d)}const g=require('./15ba1827c7f6564a45df6bd44da3a977.js'),h=require('./f171257bbcaef547a3cf27266ccb0db2.js'),i=require('./72653d4b93cdd7443296229431a7aa9a.js'),j=require('./bcb48ae14d243711d3b31cb0f602d209.js'),k=directRequire('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),l=require('./d3ce001ab1e75959382f6a7e0156dd17.js'),m=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),n=require('./25d0beb4120ce2acafb4e03b95444fda.js'),o=require('./948f9199c1cd0ba6cb9d19ad84972410.js'),p=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),q=require('./common/locales/index.js'),r='darwin'===process.platform;let s=null;module.exports={startSync:function(){global.online||global.isDevWindow||(f().catch((a)=>{i.error(`start sync error: ${a}`)}),s=setInterval(()=>{f().catch((a)=>{i.error(`start sync error: ${a}`)})},600000))},stopSync:function(){clearInterval(s)},sync:f}}(require('lazyload'),require);